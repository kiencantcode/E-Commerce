<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trial Page</title>
    <link rel="stylesheet" href="./assets/css/offer.css"> <!-- Link to your CSS file -->
</head>
<body>
    <div class="container">
        <h1>Select Your Trial</h1>
        <form id="offer-form" enctype="multipart/form-data" action="/upload-image" method="post">
            <label for="image-upload">Upload an Image:</label>
            <input type="file" id="image-upload" name="image" accept="image/*" required>

            <label for="product-select">Select a Product:</label>
            <input type="hidden" id="product-choice" name="productChoice">
            <div class="custom-dropdown">
                <div class="dropdown-select" id="product-dropdown">--Choose a Product--</div>
                <div class="dropdown-list" id="product-list">
                    <!-- Dynamic product options will be populated here -->
                </div>
            </div>

            <button type="submit">Submit</button>
        </form>

    </div>

    <script>
        // Sample product data
        const products = [
            {
                name: 'Burgundy Mercury',
                image: './assets/images/product-01.jpg'
            },
            {
                name: 'Olive Mercury',
                image: './assets/images/product-02.jpg'
            },
            {
                name: 'Sage Mercury',
                image: './assets/images/product-03.jpg'
            },
            {
                name: 'Pink Mercury',
                image: './assets/images/product-04.jpg'
            },
            {
                name: 'Reddish-brown Mercury',
                image: './assets/images/product-05.jpg'
            },
            {
                name: 'Brick-Red Mercury',
                image: './assets/images/product-06.jpg'
            },
            {
                name: 'Neon Mercury',
                image: './assets/images/product-07.jpg'
            },
            {
                name: 'Gray Mercury',
                image: './assets/images/product-08.jpg'
            },
            {
                name: 'Yellow Mercury',
                image: './assets/images/product-09.jpg'
            },
            {
                name: 'Black Mercury',
                image: './assets/images/product-10.jpg'
            }
            // Add more products as needed
        ];

        const productDropdown = document.getElementById('product-dropdown');
        const productList = document.getElementById('product-list');

        // Populate the dropdown with product names and images
        products.forEach(product => {
            const div = document.createElement('div');
            div.innerHTML = `<img src="${product.image}" alt="${product.name}">${product.name}`;
            div.onclick = function() {
                productDropdown.innerHTML = product.name; // Update dropdown text
                productDropdown.setAttribute('data-value', product.name); // Store selected value
                productList.style.display = 'none'; // Hide the dropdown list
            };
            productList.appendChild(div);
        });

        productDropdown.onclick = function() {
            productList.style.display = productList.style.display === 'block' ? 'none' : 'block'; // Toggle dropdown
        };

        document.addEventListener('click', function(event) {
            if (!productDropdown.contains(event.target)) {
                productList.style.display = 'none'; // Hide dropdown if clicked outside
            }
        });

        document.getElementById('offer-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the form from submitting in the traditional way

            const formData = new FormData();
            const imageFile = document.getElementById('image-upload').files[0];
            const selectedProduct = productDropdown.getAttribute('data-value');

            if (imageFile && selectedProduct) {
                formData.append('image', imageFile);
                formData.append('productChoice', selectedProduct);

                // Use fetch to send the form data
                fetch('/upload-image', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.text())
                .then(data => {
                    alert(data); // Show a success message without leaving the page
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to upload image');
                });
            } else {
                alert("Please select an image and a product.");
            }
        });


    </script>
</body>
</html>
